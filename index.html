<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¤ª è‡ªåŠ¨æŠ¬æ å°æ¸¸æˆ</title>
    <style>
        /* åŸæœ‰æ ·å¼å®Œå…¨ä¸å˜ï¼Œå¤åˆ¶ä½ ä¹‹å‰çš„æ ·å¼å³å¯ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "å¾®è½¯é›…é»‘", sans-serif;
        }
        body {
            background-color: #f5f5f5;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        .container {
            background: white;
            border-radius: 16px;
            padding: 30px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            font-size: 24px;
            color: #333;
            text-align: center;
            margin-bottom: 25px;
            font-weight: 600;
        }
        #ideaInput {
            width: 100%;
            height: 120px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            font-size: 16px;
            resize: none;
            margin-bottom: 20px;
            outline: none;
        }
        #ideaInput:focus {
            border-color: #409eff;
        }
        #submitBtn {
            width: 100%;
            height: 50px;
            background-color: #409eff;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            margin-bottom: 25px;
        }
        #submitBtn:active {
            background-color: #337ecc;
        }
        .result-box {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background-color: #f0f9ff;
            border-radius: 10px;
            border-left: 5px solid #409eff;
        }
        .result-box h3 {
            font-size: 18px;
            color: #333;
            margin-bottom: 10px;
        }
        #taigangResult {
            font-size: 17px;
            color: #666;
            line-height: 1.6;
        }
        #resetBtn {
            display: none;
            width: 100%;
            height: 50px;
            background-color: #f56c6c;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 15px;
        }
        #resetBtn:active {
            background-color: #e64949;
        }
    </style>
    <!-- æ–°å¢ï¼šå¼•å…¥jiebaåˆ†è¯JSç‰ˆï¼ˆæµè§ˆå™¨ç«¯CDNï¼‰ -->
    <script src="https://cdn.bootcdn.net/ajax/libs/jieba/3.6.0/jieba.min.js"></script>
    <!-- æ–°å¢ï¼šå¼•å…¥è®¯é£æ˜Ÿç«æ¥å£ä¾èµ–ï¼ˆåŠ å¯†ç”¨ï¼‰ -->
    <script src="https://cdn.bootcdn.net/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤ª è‡ªåŠ¨æŠ¬æ å°æ¸¸æˆ</h1>
        <textarea id="ideaInput" placeholder="è¯·è¾“å…¥ä½ çš„è§‚ç‚¹ï¼Œæˆ‘æ¥æŠ¬æ ï½
ä¾‹ï¼šå–å¥¶èŒ¶ä¼šèƒ–ã€åŠªåŠ›å°±èƒ½æˆåŠŸã€ç¨‹åºå‘˜éƒ½å®…"></textarea>
        <button id="submitBtn">å¼€å§‹æŠ¬æ ï¼</button>
        <div class="result-box" id="resultBox">
            <h3>ğŸ’¥ æ ç²¾ä¸Šçº¿ï¼š</h3>
            <p id="taigangResult"></p>
        </div>
        <button id="resetBtn">é‡æ–°è¾“å…¥</button>
    </div>

    <script>
        // åŸæœ‰å…ƒç´ è·å–é€»è¾‘å®Œå…¨ä¸å˜
        const ideaInput = document.getElementById('ideaInput');
        const submitBtn = document.getElementById('submitBtn');
        const resultBox = document.getElementById('resultBox');
        const taigangResult = document.getElementById('taigangResult');
        const resetBtn = document.getElementById('resetBtn');

        // ====================== æ–°å¢/ä¿®æ”¹éƒ¨åˆ†å¼€å§‹ ======================
        // 1. é…ç½®è®¯é£æ˜Ÿç«APIå¯†é’¥ï¼ˆæ›¿æ¢æˆä½ è‡ªå·±çš„ï¼ï¼‰
        const XF_CONFIG = {
            appid: "84271b25",
            apiKey: "107e95f305daec99a915f41bd14005ab",
            apiSecret: "NThkNjA3YWI4NTc5MGYwM2U5OTY3Mzg1"
        };

        // 2. æ–°å¢ï¼šå…³é”®è¯æå–å‡½æ•°ï¼ˆåŸºäºjiebaåˆ†è¯ï¼‰
        function extractKeywords(idea) {
            if (!idea.trim()) return "";
            // åŠ è½½jiebaè¯å…¸ï¼ˆæµè§ˆå™¨ç«¯éœ€æ‰‹åŠ¨åŠ è½½ï¼‰
            jieba.load(function() {
                // åˆ†è¯å¹¶è¿‡æ»¤åœç”¨è¯ï¼ˆå¦‚â€œçš„ã€ä¼šã€èƒ½â€ç­‰æ— æ„ä¹‰è¯ï¼‰
                const words = jieba.cut(idea.trim(), false);
                const stopWords = ['çš„', 'äº†', 'æ˜¯', 'ä¼š', 'èƒ½', 'å°±', 'éƒ½', 'æœ‰', 'åœ¨', 'å’Œ', 'ä¹Ÿ', 'ä½†', 'å¦‚æœ'];
                // æå–æ ¸å¿ƒå…³é”®è¯ï¼ˆé•¿åº¦â‰¥2ï¼Œéåœç”¨è¯ï¼‰
                const keywords = words.filter(word => word.length >= 2 && !stopWords.includes(word));
                return keywords.join("ã€");
            });
            // å…œåº•ï¼šå¦‚æœåˆ†è¯å¤±è´¥ï¼Œå–å‰10ä¸ªå­—
            return idea.trim().replace(/\s+/g, '').substring(0, 10);
        }

        // 3. æ–°å¢ï¼šè®¯é£æ˜Ÿç«APIè°ƒç”¨å‡½æ•°ï¼ˆè½»é‡ç‰ˆï¼Œä»…ç”ŸæˆæŠ¬æ å†…å®¹ï¼‰
        async function callXFApi(prompt) {
            // ç”Ÿæˆè¯·æ±‚ç­¾åï¼ˆè®¯é£æ¥å£è¦æ±‚ï¼Œå›ºå®šé€»è¾‘ï¼‰
            const timestamp = new Date().getTime();
            const signature = CryptoJS.HmacSHA256(`host:spark-api.xf-yun.com\ndate:${timestamp}\nGET /v1/chat/completions HTTP/1.1`, XF_CONFIG.apiSecret).toString(CryptoJS.enc.Base64);
            
            // æ„é€ AIæç¤ºè¯ï¼ˆæ˜ç¡®5ä¸ªæŠ¬æ è§’åº¦ï¼Œè®©AIç²¾å‡†ç”Ÿæˆï¼‰
            const aiPrompt = `
                è¯·é’ˆå¯¹è§‚ç‚¹ã€Œ${prompt}ã€ï¼Œä»ä»¥ä¸‹5ä¸ªè§’åº¦ç”Ÿæˆ1å¥æŠ¬æ çš„è¯ï¼Œè¦æ±‚å£è¯­åŒ–ã€è´´åˆè§‚ç‚¹ã€ä¸è·‘åï¼š
                1. è´¨ç–‘å‰æï¼šè´¨ç–‘è§‚ç‚¹çš„é»˜è®¤å‰ææ˜¯å¦æˆç«‹ï¼›
                2. æ¨¡ç³Šå®šä¹‰ï¼šè¿½é—®è§‚ç‚¹ä¸­å…³é”®è¯çš„å®šä¹‰ï¼›
                3. ä»¥åæ¦‚å…¨ï¼šæŒ‡å‡ºè§‚ç‚¹æ˜¯å¦ä»¥ä¸ªåˆ«æ¡ˆä¾‹æ¨æ•´ä½“ï¼›
                4. å› æœæ··æ·†ï¼šè´¨ç–‘è§‚ç‚¹çš„å› æœå…³ç³»æ˜¯å¦æˆç«‹ï¼›
                5. æç«¯å‡è®¾ï¼šå°†è§‚ç‚¹æ¨åˆ°æç«¯æƒ…å†µéªŒè¯æ˜¯å¦æˆç«‹ã€‚
                è¦æ±‚ï¼šåªè¿”å›æŠ¬æ çš„è¯ï¼Œä¸è¦å¤šä½™è§£é‡Šï¼Œå­—æ•°æ§åˆ¶åœ¨50å­—ä»¥å†…ã€‚
            `.trim();

            try {
                // è°ƒç”¨è®¯é£æ˜Ÿç«API
                const res = await fetch("https://maas-api.cn-huabei-1.xf-yun.com/v2", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "appid": XF_CONFIG.appid,
                        "timestamp": timestamp,
                        "signature": signature
                    },
                    body: JSON.stringify({
                        model: "spark-3.5-mini", // å…è´¹è½»é‡æ¨¡å‹
                        messages: [{ role: "user", content: aiPrompt }],
                        temperature: 0.8, // éšæœºæ€§
                        max_tokens: 100 // æœ€å¤§ç”Ÿæˆå­—æ•°
                    })
                });

                const data = await res.json();
                // æå–AIç”Ÿæˆçš„å†…å®¹
                if (data.choices && data.choices.length > 0) {
                    return data.choices[0].message.content.trim();
                } else {
                    return "AIæš‚æ—¶ç½¢å·¥äº†ï½æ¢ä¸ªè§‚ç‚¹è¯•è¯•ğŸ˜œ";
                }
            } catch (err) {
                console.error("APIè°ƒç”¨å¤±è´¥ï¼š", err);
                // å…œåº•ï¼šè°ƒç”¨å¤±è´¥æ—¶ç”¨åŸæ¨¡æ¿ï¼ˆä¿è¯åŠŸèƒ½ä¸æŒ‚ï¼‰
                return `ä½ è¯´çš„ã€Œ${prompt}ã€ï¼Œé»˜è®¤çš„å‰ææ˜¯ä»€ä¹ˆï¼Ÿè¿™ä¸ªå‰æçœŸçš„æˆç«‹å—ï¼Ÿæœ‰ä¾æ®å—ï¼Ÿ`;
            }
        }

        // 4. ä¿®æ”¹ï¼šæ›¿æ¢åŸgenerateTaigangå‡½æ•°ï¼ˆæ ¸å¿ƒé€»è¾‘æ›¿æ¢ï¼Œä¿ç•™å…¥å‚/å‡ºå‚ï¼‰
        async function generateTaigang(idea) {
            if (!idea.trim()) return "ä½ è¿˜æ²¡è¾“å…¥è§‚ç‚¹å‘¢ï¼Œæƒ³è®©æˆ‘æ ç©ºæ°”ï¼ŸğŸ˜œ";
            // æå–å…³é”®è¯ï¼Œè®©AIæ›´ç²¾å‡†
            const keywords = extractKeywords(idea);
            // è°ƒç”¨AIæ¥å£ç”ŸæˆæŠ¬æ å†…å®¹ï¼ˆæ‹¼æ¥å…³é”®è¯ï¼Œæå‡ç²¾å‡†åº¦ï¼‰
            const aiResult = await callXFApi(`${idea}ï¼ˆæ ¸å¿ƒè¯ï¼š${keywords}ï¼‰`);
            return aiResult;
        }
        // ====================== æ–°å¢/ä¿®æ”¹éƒ¨åˆ†ç»“æŸ ======================

        // åŸæœ‰äº¤äº’é€»è¾‘å®Œå…¨ä¸å˜ï¼Œä»…ä¿®æ”¹submitBtnç‚¹å‡»äº‹ä»¶ä¸ºasync
        submitBtn.addEventListener('click', async function() {
            const idea = ideaInput.value;
            // ç”ŸæˆæŠ¬æ ç»“æœï¼ˆæ”¹ä¸ºawaitè°ƒç”¨ï¼‰
            const result = await generateTaigang(idea);
            // åŸæœ‰æ˜¾ç¤ºé€»è¾‘ä¸å˜
            taigangResult.textContent = result;
            resultBox.style.display = 'block';
            resetBtn.style.display = 'block';
            resultBox.scrollIntoView({ behavior: 'smooth' });
        });

        // åŸæœ‰é‡ç½®æŒ‰é’®é€»è¾‘ä¸å˜
        resetBtn.addEventListener('click', function() {
            ideaInput.value = '';
            resultBox.style.display = 'none';
            resetBtn.style.display = 'none';
            ideaInput.focus();
        });

        // åŸæœ‰å›è½¦æäº¤é€»è¾‘ä¸å˜
        ideaInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && e.ctrlKey) {
                submitBtn.click();
            }
        });
    </script>
</body>
</html>
