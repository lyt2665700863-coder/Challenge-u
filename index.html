<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¤ª è‡ªåŠ¨æŠ¬æ å°æ¸¸æˆ</title>
    <style>
        /* åŸæœ‰æ ·å¼å®Œå…¨ä¿ç•™ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "å¾®è½¯é›…é»‘", sans-serif;
        }
        body {
            background-color: #f5f5f5;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        .container {
            background: white;
            border-radius: 16px;
            padding: 30px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            font-size: 24px;
            color: #333;
            text-align: center;
            margin-bottom: 25px;
            font-weight: 600;
        }
        #ideaInput {
            width: 100%;
            height: 120px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            font-size: 16px;
            resize: none;
            margin-bottom: 20px;
            outline: none;
        }
        #ideaInput:focus {
            border-color: #409eff;
        }
        #submitBtn {
            width: 100%;
            height: 50px;
            background-color: #409eff;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            margin-bottom: 25px;
        }
        #submitBtn:active {
            background-color: #337ecc;
        }
        #submitBtn:disabled {
            background-color: #b3d8ff;
            cursor: not-allowed;
        }
        .result-box {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background-color: #f0f9ff;
            border-radius: 10px;
            border-left: 5px solid #409eff;
        }
        .result-box h3 {
            font-size: 18px;
            color: #333;
            margin-bottom: 10px;
        }
        #taigangResult {
            font-size: 17px;
            color: #666;
            line-height: 1.6;
        }
        #resetBtn {
            display: none;
            width: 100%;
            height: 50px;
            background-color: #f56c6c;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 15px;
        }
        #resetBtn:active {
            background-color: #e64949;
        }
        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #fff;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <!-- å¼•å…¥jiebaåˆ†è¯JSç‰ˆï¼ˆæµè§ˆå™¨ç«¯CDNï¼‰ -->
    <script src="https://cdn.bootcdn.net/ajax/libs/jieba/3.6.0/jieba.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤ª è‡ªåŠ¨æŠ¬æ å°æ¸¸æˆ</h1>
        <textarea id="ideaInput" placeholder="è¯·è¾“å…¥ä½ çš„è§‚ç‚¹ï¼Œæˆ‘æ¥æŠ¬æ ï½
ä¾‹ï¼šå–å¥¶èŒ¶ä¼šèƒ–ã€åŠªåŠ›å°±èƒ½æˆåŠŸã€ç¨‹åºå‘˜éƒ½å®…"></textarea>
        <button id="submitBtn">
            <span id="btnText">å¼€å§‹æŠ¬æ ï¼</span>
        </button>
        <div class="result-box" id="resultBox">
            <h3>ğŸ’¥ æ ç²¾ä¸Šçº¿ï¼š</h3>
            <p id="taigangResult"></p>
        </div>
        <button id="resetBtn">é‡æ–°è¾“å…¥</button>
    </div>

    <script>
        // åŸæœ‰å…ƒç´ è·å–é€»è¾‘ä¸å˜
        const ideaInput = document.getElementById('ideaInput');
        const submitBtn = document.getElementById('submitBtn');
        const resultBox = document.getElementById('resultBox');
        const taigangResult = document.getElementById('taigangResult');
        const resetBtn = document.getElementById('resetBtn');
        const btnText = document.getElementById('btnText');

        // ====================== æ˜Ÿç«æ·±åº¦æ¨ç†X1.5æ¥å£é…ç½® ======================
        // è¯·æ›¿æ¢ä¸ºä½ çš„APIpasswordï¼ˆä»è®¯é£æ§åˆ¶å°è·å–ï¼šhttps://console.xfyun.cn/services/bmx1ï¼‰
        const XF_CONFIG = {
            apiPassword: "SOnIGTdiseRiCZcNJmmP:JvnSuHibtwphyDyowmJu", // ã€å¿…å¡«ã€‘æ›¿æ¢ä¸ºä½ çš„APIpassword
            apiUrl: "https://spark-api-open.xf-yun.com/v2/chat/completions", // X1.5æ­£å¼ç‰ˆåœ°å€
            modelId: "spark-x" // å›ºå®šå€¼ï¼Œæ— éœ€ä¿®æ”¹
        };

        // ====================== å…³é”®è¯æå–å‡½æ•°ï¼ˆä¿ç•™åŸæœ‰é€»è¾‘ï¼‰ ======================
        // é¢„åŠ è½½jiebaè¯å…¸
        let jiebaLoaded = false;
        jieba.load(function() {
            jiebaLoaded = true;
            console.log("jiebaåˆ†è¯åˆå§‹åŒ–å®Œæˆ");
        });

        function extractKeywords(idea) {
            if (!idea.trim()) return "";
            
            if (!jiebaLoaded) {
                return idea.trim().replace(/\s+/g, '').substring(0, 10);
            }

            try {
                const words = jieba.cut(idea.trim(), false);
                const stopWords = ['çš„', 'äº†', 'æ˜¯', 'ä¼š', 'èƒ½', 'å°±', 'éƒ½', 'æœ‰', 'åœ¨', 'å’Œ', 'ä¹Ÿ', 'ä½†', 'å¦‚æœ'];
                const keywords = words.filter(word => word.length >= 2 && !stopWords.includes(word));
                return keywords.length > 0 ? keywords.join("ã€") : idea.trim().substring(0, 10);
            } catch (e) {
                return idea.trim().substring(0, 10);
            }
        }

        // ====================== é€‚é…æ˜Ÿç«X1.5æ¥å£è°ƒç”¨å‡½æ•° ======================
        async function callXFApi(prompt) {
            submitBtn.disabled = true;
            btnText.innerHTML = '<span class="loading"></span>æ ç²¾æ­£åœ¨æ€è€ƒ...';

            try {
                // æ„é€ AIæç¤ºè¯ï¼ˆä¿ç•™5ä¸ªæŠ¬æ è§’åº¦ï¼‰
                const aiPrompt = `
                    è¯·é’ˆå¯¹è§‚ç‚¹ã€Œ${prompt}ã€ï¼Œä»ä»¥ä¸‹5ä¸ªè§’åº¦ç”Ÿæˆ1å¥æŠ¬æ çš„è¯ï¼Œè¦æ±‚å£è¯­åŒ–ã€è´´åˆè§‚ç‚¹ã€ä¸è·‘åï¼š
                    1. è´¨ç–‘å‰æï¼šè´¨ç–‘è§‚ç‚¹çš„é»˜è®¤å‰ææ˜¯å¦æˆç«‹ï¼›
                    2. æ¨¡ç³Šå®šä¹‰ï¼šè¿½é—®è§‚ç‚¹ä¸­å…³é”®è¯çš„å®šä¹‰ï¼›
                    3. ä»¥åæ¦‚å…¨ï¼šæŒ‡å‡ºè§‚ç‚¹æ˜¯å¦ä»¥ä¸ªåˆ«æ¡ˆä¾‹æ¨æ•´ä½“ï¼›
                    4. å› æœæ··æ·†ï¼šè´¨ç–‘è§‚ç‚¹çš„å› æœå…³ç³»æ˜¯å¦æˆç«‹ï¼›
                    5. æç«¯å‡è®¾ï¼šå°†è§‚ç‚¹æ¨åˆ°æç«¯æƒ…å†µéªŒè¯æ˜¯å¦æˆç«‹ã€‚
                    è¦æ±‚ï¼šåªè¿”å›æŠ¬æ çš„è¯ï¼Œä¸è¦å¤šä½™è§£é‡Šï¼Œå­—æ•°æ§åˆ¶åœ¨50å­—ä»¥å†…ã€‚
                `.trim();

                // æ„é€ è¯·æ±‚ä½“ï¼ˆä¸¥æ ¼æŒ‰X1.5æ–‡æ¡£è§„èŒƒï¼‰
                const requestBody = {
                    model: XF_CONFIG.modelId, // å›ºå®šä¸ºspark-x
                    user: "taigang_game_" + Math.random().toString(36).substr(2, 8), // éšæœºç”¨æˆ·ID
                    messages: [{"role": "user", "content": aiPrompt}], // å¿…å¡«æ¶ˆæ¯åˆ—è¡¨
                    temperature: 1.2, // X1.5é»˜è®¤å€¼1.2
                    top_p: 0.95, // X1.5é»˜è®¤å€¼
                    top_k: 6, // X1.5é»˜è®¤å€¼
                    max_tokens: 65535, // X1.5æœ€å¤§tokenæ•°
                    stream: false // éæµå¼å“åº”
                };

                // å‘èµ·è¯·æ±‚ï¼ˆæŒ‰X1.5æ–‡æ¡£çš„é‰´æƒå’Œåœ°å€è§„èŒƒï¼‰
                const res = await fetch(XF_CONFIG.apiUrl, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${SOnIGTdiseRiCZcNJmmP:JvnSuHibtwphyDyowmJu}` // ä»…ä¿ç•™Bearer + APIpassword
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!res.ok) {
                    throw new Error(`æ¥å£è°ƒç”¨å¤±è´¥ï¼š${res.status} ${res.statusText}`);
                }

                const data = await res.json();
                console.log("æ˜Ÿç«X1.5æ¥å£å“åº”ï¼š", data);

                // æŒ‰X1.5æ–‡æ¡£è§£æå“åº”
                if (data.code === 0 && data.choices && data.choices.length > 0) {
                    return data.choices[0].message.content.trim();
                } else {
                    // å¤„ç†æ¥å£è¿”å›é”™è¯¯ä¿¡æ¯
                    const errMsg = data.message || "AIæš‚æ—¶ç½¢å·¥äº†ï½æ¢ä¸ªè§‚ç‚¹è¯•è¯•ğŸ˜œ";
                    return errMsg;
                }
            } catch (err) {
                console.error("APIè°ƒç”¨å¤±è´¥è¯¦æƒ…ï¼š", err);
                // å…œåº•é€»è¾‘
                return `ä½ è¯´çš„ã€Œ${prompt}ã€ï¼Œé»˜è®¤çš„å‰ææ˜¯ä»€ä¹ˆï¼Ÿè¿™ä¸ªå‰æçœŸçš„æˆç«‹å—ï¼Ÿæœ‰ä¾æ®å—ï¼Ÿ`;
            } finally {
                submitBtn.disabled = false;
                btnText.innerHTML = "å¼€å§‹æŠ¬æ ï¼";
            }
        }

        // ====================== æ ¸å¿ƒæŠ¬æ ç”Ÿæˆå‡½æ•° ======================
        async function generateTaigang(idea) {
            if (!idea.trim()) return "ä½ è¿˜æ²¡è¾“å…¥è§‚ç‚¹å‘¢ï¼Œæƒ³è®©æˆ‘æ ç©ºæ°”ï¼ŸğŸ˜œ";
            const keywords = extractKeywords(idea);
            const aiResult = await callXFApi(`${idea}ï¼ˆæ ¸å¿ƒè¯ï¼š${keywords}ï¼‰`);
            return aiResult;
        }

        // ====================== äº¤äº’é€»è¾‘ï¼ˆä¿ç•™åŸæœ‰ï¼‰ ======================
        submitBtn.addEventListener('click', async function() {
            const idea = ideaInput.value.trim();
            if (!idea) {
                alert("å…ˆè¾“å…¥ä½ çš„è§‚ç‚¹å†æŠ¬æ å“¦ï½");
                return;
            }

            const result = await generateTaigang(idea);
            taigangResult.textContent = result;
            resultBox.style.display = 'block';
            resetBtn.style.display = 'block';
            resultBox.scrollIntoView({ behavior: 'smooth' });
        });

        resetBtn.addEventListener('click', function() {
            ideaInput.value = '';
            resultBox.style.display = 'none';
            resetBtn.style.display = 'none';
            ideaInput.focus();
        });

        ideaInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && e.ctrlKey) {
                e.preventDefault();
                submitBtn.click();
            }
        });

        window.addEventListener('load', function() {
            ideaInput.focus();
        });
    </script>
</body>
</html>
